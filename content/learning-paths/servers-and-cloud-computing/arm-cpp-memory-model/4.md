---
title: Detecting Race Conditions 
weight: 5

### FIXED, DO NOT MODIFY
layout: learningpathall
---

## How to detect infrequent race conditions?

Threadsantizer, commonly referred to as `TSan` is a concurrency bug detection tool that identifies data races in multi-threaded programs. By instrumenting code at compile time, TSan dynamically tracks memory operations, monitoring lock usage and detecting inconsistencies in thread synchronization. When it finds a potential data race, it reports detailed information to aid debugging. TSan’s overhead can be significant, but it provides valuable insights into concurrency issues often missed by static analysis.

TSan is available through both recent `clang` and `gcc` compilers. Using the `clang++` compiler in this example, compiling the correct_memory_ordering example with the following command and running the output binary. 

```bash
clang++ relaxed_memory_ordering.cpp -fsanitize=thread -fPIE -pie -g
```



```output
==================
WARNING: ThreadSanitizer: data race (pid=2892958)
  Read of size 4 at 0xfffff42007b0 by thread T2:
   ...
   ...
   ...
SUMMARY: ThreadSanitizer: data race /home/ubuntu/src/relaxed_memory_ordering.cpp:23:12 in threadB()
==================

```

The summary output highlights a potential data race in the `threadB` function corresponding to the source code expression `n->x != 42`. 

## TSan's limitations

Thread Sanitizer (TSan) is powerful for detecting data races but has notable drawbacks. First, it only identifies concurrency issues at runtime, meaning any problematic code that isn’t exercised during testing goes unnoticed. Additionally, if race conditions exist in third-party binaries or libraries, TSan can’t instrument or fix them without access to their source code. Another major limitation is performance overhead: TSan can slow programs by 2 to 20x and requires extra memory, making it challenging for large-scale or real-time systems. 

For further information please refer to the [Google documentation](https://github.com/google/sanitizers/wiki/threadsanitizercppmanual).