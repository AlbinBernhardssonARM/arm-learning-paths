---
title: Using Optimised Math Library
weight: 4

### FIXED, DO NOT MODIFY
layout: learningpathall
---

## Example using Optimised Math library

The libamath library from Arm is an optimized subset of the standard library math functions, providing both scalar and vector functions at different levels of precision. It includes vectorized versions (Neon and SVE) of common math functions found in the standard library, such as those in the <cmath> header.

The trivial snippet below uses the `<cmath>` standard cmath header. Copy and paste the code sample below into a file named `basic_math.cpp`.

```c++
#include <iostream>
#include <ctime>
#include <cmath>  // Include the standard library

int main() {
    std::srand(std::time(0));
    double random_number = std::rand() / static_cast<double>(RAND_MAX);
    double result = exp(random_number); // Use the optimized exp function from libamath
    std::cout << "Exponential of " << random_number << " is " << result << std::endl;
    return 0;
}
```

Compiling using the following g++ command. We can use the `ldd` command to print the shared objects for dynamic linking. Here we observe the superset `libm.so` is linked.

```output
g++ basic_math.cpp -o basic_math
ldd basic_math
        linux-vdso.so.1 (0x0000f55218587000)
        libstdc++.so.6 => /lib/aarch64-linux-gnu/libstdc++.so.6 (0x0000f55218200000)
        libm.so.6 => /lib/aarch64-linux-gnu/libm.so.6 (0x0000f55218490000)
        libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000f55218050000)
        /lib/ld-linux-aarch64.so.1 (0x0000f5521854e000)
        libgcc_s.so.1 => /lib/aarch64-linux-gnu/libgcc_s.so.1 (0x0000f55218460000)
```

## Updating to use Optimised Library

To use the optimised math library `libamath` requires minimal source code changes, just modifying the include statements to point to the correct header file and additional compiler flags. 

Copy and paste the following C++ snippet into a file named `optimised_math.cpp`.

```c++
#include <iostream>
#include <ctime>
#include <amath.h> // Include the Arm Performance Library header

int main() {
    std::srand(std::time(0));
    double random_number = std::rand() / static_cast<double>(RAND_MAX);
    double result = exp(random_number); // Use the optimized exp function from libamath
    std::cout << "Exponential of " << random_number << " is " << result << std::endl;
    return 0;
}
```

Compiling using the following g++ command. Again we can use the `ldd` command to print the shared objects for dynamic linking. Now we can opbserve the `libamath.so` shared object is linked. 

```output
g++ optimised_math.cpp -o optimised_math -lamath -lm
ldd optimised_math
        linux-vdso.so.1 (0x0000eb1eb379b000)
        libamath.so => /opt/arm/armpl_24.10_gcc/lib/libamath.so (0x0000eb1eb35c0000)
        libstdc++.so.6 => /lib/aarch64-linux-gnu/libstdc++.so.6 (0x0000eb1eb3200000)
        libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000eb1eb3050000)
        libm.so.6 => /lib/aarch64-linux-gnu/libm.so.6 (0x0000eb1eb3520000)
        /lib/ld-linux-aarch64.so.1 (0x0000eb1eb3762000)
        libgcc_s.so.1 => /lib/aarch64-linux-gnu/libgcc_s.so.1 (0x0000eb1eb34f0000
```


```c++
#include <iostream>
#include <cstdlib>
#include <ctime>
#include <cmath> // 

int main() {
    std::srand(std::time(0));
    double random_number = std::rand() / static_cast<double>(RAND_MAX);
    double result = exp(random_number); // Use reg
    std::cout << "Exponential of " << random_number << " is " << result << std::endl;
    return 0;
}
```

```bash
g++ x.cpp -o x -lamath -lm
```

```output
ldd x
        linux-vdso.so.1 (0x0000ef553b10a000)
        libamath.so => /opt/arm/armpl_24.10_gcc/lib/libamath.so (0x0000ef553af30000)
        libstdc++.so.6 => /lib/aarch64-linux-gnu/libstdc++.so.6 (0x0000ef553ac00000)
        libc.so.6 => /lib/aarch64-linux-gnu/libc.so.6 (0x0000ef553aa50000)
        libm.so.6 => /lib/aarch64-linux-gnu/libm.so.6 (0x0000ef553ae90000)
        /lib/ld-linux-aarch64.so.1 (0x0000ef553b0d1000)
        libgcc_s.so.1 => /lib/aarch64-linux-gnu/libgcc_s.so.1 (0x0000ef553ae60000)
```

```
#include <iostream>
#include <cstdlib>
#include <ctime>
#include <amath.h> // Include the Arm Performance Library header

int main() {
    std::srand(std::time(0));
    double random_number = std::rand() / static_cast<double>(RAND_MAX);
    double result = exp(random_number); // Use the optimized exp function from libamath
    std::cout << "Exponential of " << random_number << " is " << result << std::endl;
    return 0;
}

```


